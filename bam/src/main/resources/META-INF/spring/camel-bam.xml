<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd 
            http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

	<bean id="sendDataSet" class="rspasov.bam.dataset.OrderReceivedDataSet">
		<property name="reportCount" value="10" />
		<property name="size" value="1000" />
	</bean>
	
	<bean id="movingAverageProcessor" class="rspasov.bam.processor.MovingAverageProcessor" />

	<camelContext id="defaultContext" xmlns="http://camel.apache.org/schema/spring" autoStartup="true">
		
		<endpoint id="websocketEndpoint" uri="websocket://localhost:8080/events?sendToAll=true&amp;staticResources=classpath:webapp" />
		
		<dataFormats>
			<json id="json" library="Jackson" />
		</dataFormats>

		<route>
			<from uri="dataset:sendDataSet?produceDelay=500" />
			<choice>
	            <when>
	                <simple>${header.dimension} == 'Google'</simple>
	                <process ref="movingAverageProcessor" />
					<marshal ref="json" />
					<convertBodyTo type="java.lang.String" />
					<to ref="websocketEndpoint" />
	            </when>
	            <otherwise>
	                <stop />
	            </otherwise>
	        </choice>
			<to uri="dataset:sendDataSet" />
		</route>

	</camelContext>
	
</beans>