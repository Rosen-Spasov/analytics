<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<title>Simple Chart Viewer</title>
</head>

<script src="js/jquery.min.js"></script>
<script src="js/Chart.js"></script>
<script type="text/javascript">

	Chart.defaults.global.responsive = true;

	var myLineChart = null;
	
	var data = {
		labels: [],
	    datasets: [
	               {
	                   label: "My First dataset",
	                   fillColor: "rgba(220,220,220,0.2)",
	                   strokeColor: "rgba(220,220,220,1)",
	                   pointColor: "rgba(220,220,220,1)",
	                   pointStrokeColor: "#fff",
	                   pointHighlightFill: "#fff",
	                   pointHighlightStroke: "rgba(220,220,220,1)",
	               },
	               {
	                   label: "My Second dataset",
	                   fillColor: "rgba(151,187,205,0.2)",
	                   strokeColor: "rgba(151,187,205,1)",
	                   pointColor: "rgba(151,187,205,1)",
	                   pointStrokeColor: "#fff",
	                   pointHighlightFill: "#fff",
	                   pointHighlightStroke: "rgba(151,187,205,1)",
	               }
	    ]
	};
	
	function addEventToChart(event) {
		myLineChart.addData([event.originalEvent.fact, event.movingAverageEvent.fact], event.timestamp);
	}
	
    function processEvent(data) {
        console.log('Data received:', data);
        var event = jQuery.parseJSON(data);
        addEventToChart(event)
    }

    var app = {
        start:function () {
            var location = "ws://localhost:8080/events";
            this._ws = new WebSocket(location);
            this._ws.onmessage = this._onmessage;
            this._ws.onclose = this._onclose;
        },

        _onmessage:function (m) {
            if (m.data) {
                processEvent(m.data);
            }
        },

        _onclose:function (m) {
            this._ws = null;
        }
    };

    $(document).ready(function () {
        if (!window.WebSocket) {
            $('#pictures').text("ERROR: Your browser doesn't support websockets!");
        } else {
            app.start();
        }
    });
    
</script>

<body>
	<canvas id="myChart" width="400" height="200"></canvas>
	<script>
		// Get the context of the canvas element we want to select
		var ctx = document.getElementById("myChart").getContext("2d");
		myLineChart = new Chart(ctx).Line(data);
	</script>
</body>
</html>